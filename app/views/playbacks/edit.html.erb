<%= render partial: "shared/playback_wizard" %>
<%= render partial: "shared/waiting_modal" %>

<script>
	$( document ).ready(function() {
		if ($("#playback_name").val != "") {
			$("#nextBtn").removeAttr("disabled");
		}
		$("#playback_name").keyup(function() {
			if ($("#playback_name").val() != "") {
				$("#nextBtn").removeAttr("disabled");
			} else {
				$("#nextBtn").attr("disabled", "disabled");
			}
	  	});
  	
		enable_canvas();

		$("#recordBtn").click(function() {
  			player().record();
  			$("#playbackBtn").attr('disabled', 'disabled');
	  	});

		$("#playbackBtn").click(function() {
  			player().recording.setFrames(player().recording.frameData);
            player().play();
	  	});

	  	$('#myWizard').on('finished.fu.wizard', function (evt, data) {
	  		if (player().recording) {
	  			$('#myPleaseWait').modal('show');
	  			playback_data = player().recording.export("lz") 
	  			$.ajax({
					  dataType: 'html',
					  method: "PUT",
					  url: "/playbacks/<%= @playback.id %>",
					  data: {playback: { name: $("#playback_name").val(), data: playback_data } }
					}).done(function( msg ) {
					    $('#myPleaseWait').modal('hide');
					    window.location.href = "/playbacks";
					});
	  		} else {
	  			alert("Please record the playback.");
	  		}
			
		});

  	});

</script>